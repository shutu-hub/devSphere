# devSphere-chat - é«˜æ€§èƒ½å®æ—¶èŠå¤©æœåŠ¡

<div align="center">

[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.x-green)](#)
[![Netty](https://img.shields.io/badge/Netty-4.1.76.Final-blue)](#)
[![MyBatis Plus](https://img.shields.io/badge/MyBatis%20Plus-3.5.7-orange)](#)
[![Redis](https://img.shields.io/badge/Redis-Streaming-red)](#)

</div>

## ğŸŒŸ é¡¹ç›®äº®ç‚¹

devSphere-chat æ˜¯ä¸€ä¸ªåŸºäº Spring Boot æ„å»ºçš„ä¼ä¸šçº§å®æ—¶èŠå¤©æœåŠ¡ï¼Œä¸“ä¸ºé«˜å¹¶å‘ã€ä½å»¶è¿Ÿçš„å³æ—¶é€šè®¯åœºæ™¯è®¾è®¡ã€‚å®ƒä¸ä»…æä¾›äº†å®Œæ•´çš„ç§èŠå’Œç¾¤èŠåŠŸèƒ½ï¼Œè¿˜é€šè¿‡åˆ›æ–°çš„æŠ€æœ¯æ¶æ„ç¡®ä¿äº†æ¶ˆæ¯çš„å¯é ä¼ è¾“å’Œç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚

### ğŸš€ æ ¸å¿ƒä¼˜åŠ¿

- **é«˜å¹¶å‘æ”¯æŒ**: åŸºäº Netty çš„å¼‚æ­¥äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œè½»æ¾åº”å¯¹ä¸‡çº§å¹¶å‘è¿æ¥
- **æ¶ˆæ¯å¯é æ€§**: Redis Stream æ¶ˆæ¯é˜Ÿåˆ— + æ­»ä¿¡é˜Ÿåˆ—æœºåˆ¶ï¼Œç¡®ä¿æ¶ˆæ¯é›¶ä¸¢å¤±
- **æ¶æ„å…ˆè¿›**: äº‹ä»¶é©±åŠ¨ + å¼‚æ­¥å¤„ç†æ¨¡å¼ï¼Œæå‡ç³»ç»Ÿæ•´ä½“æ€§èƒ½
- **æ‰©å±•æ€§å¼º**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºå®šåˆ¶å’ŒäºŒæ¬¡å¼€å‘

## ğŸ’¬ èŠå¤©æœåŠ¡è¯¦è§£

### ğŸ“± åŠŸèƒ½ç‰¹æ€§

#### åŸºç¡€èŠå¤©åŠŸèƒ½
- **ç§èŠ(P2P)**: ç”¨æˆ·ä¹‹é—´ä¸€å¯¹ä¸€å®æ—¶æ¶ˆæ¯ä¼ é€’
- **ç¾¤èŠ(Room)**: æ”¯æŒå¤šäººåŒæ—¶åœ¨çº¿èŠå¤©
- **å¤šæ¶ˆæ¯ç±»å‹**: æ–‡æœ¬ã€å›¾ç‰‡ã€è¯­éŸ³ã€è§†é¢‘ã€æ–‡ä»¶ç­‰å¤šç§æ¶ˆæ¯æ ¼å¼
- **ç¦»çº¿æ¶ˆæ¯**: è‡ªåŠ¨å­˜å‚¨å’Œæ¨é€ç”¨æˆ·ç¦»çº¿æœŸé—´çš„æ¶ˆæ¯
- **æ¶ˆæ¯çŠ¶æ€**: å·²è¯»/æœªè¯»æ ‡è®°ã€æ¶ˆæ¯æ’¤å›ç­‰çŠ¶æ€ç®¡ç†

#### ç¤¾äº¤åŠŸèƒ½
- **å¥½å‹ç®¡ç†**: æ·»åŠ ã€åˆ é™¤ã€å¤‡æ³¨å¥½å‹å…³ç³»
- **ç¾¤ç»„ç®¡ç†**: åˆ›å»ºã€è§£æ•£ç¾¤ç»„ï¼Œæˆå‘˜ç®¡ç†
- **ä¼šè¯åˆ—è¡¨**: å®æ—¶å±•ç¤ºç§èŠå’Œç¾¤èŠä¼šè¯åˆ—è¡¨
- **æ¶ˆæ¯é€šçŸ¥**: ç³»ç»Ÿé€šçŸ¥ã€å¥½å‹ç”³è¯·ã€ç¾¤èŠé‚€è¯·ç­‰æé†’

### ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WebSocket     â”‚    â”‚   HTTP API      â”‚    â”‚   å®šæ—¶ä»»åŠ¡      â”‚
â”‚   (Netty)       â”‚    â”‚   (Spring MVC)  â”‚    â”‚   (Scheduler)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚                      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  ä¸šåŠ¡é€»è¾‘å±‚        â”‚
                     â”‚  (Service Layer)  â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                    â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySQLæ•°æ®åº“      â”‚ â”‚   Redisç¼“å­˜      â”‚ â”‚   Feignè¿œç¨‹è°ƒç”¨    â”‚
â”‚  (æŒä¹…åŒ–å­˜å‚¨)      â”‚ â”‚  (æ¶ˆæ¯é˜Ÿåˆ—)      â”‚ â”‚  (ç”¨æˆ·æœåŠ¡)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### ğŸ”§ æ ¸å¿ƒç»„ä»¶è§£æ

#### æ¶ˆæ¯å¤„ç†å¼•æ“
ç³»ç»Ÿé‡‡ç”¨äº‹ä»¶é©±åŠ¨æ¶æ„å¤„ç†å„ç±»æ¶ˆæ¯ï¼š
- [`PrivateMessageListener`]: ç§èŠæ¶ˆæ¯ç›‘å¬å™¨ï¼Œè´Ÿè´£å¤„ç†ç‚¹å¯¹ç‚¹æ¶ˆæ¯çš„æŒä¹…åŒ–
- [`GroupMessageListener`]: ç¾¤èŠæ¶ˆæ¯ç›‘å¬å™¨ï¼Œå¤„ç†ç¾¤ç»„å†…æ¶ˆæ¯å¹¿æ’­
- [`MessageStreamListener`]: Redis Stream æ¶ˆæ¯ç›‘å¬å™¨ï¼Œæ¶ˆè´¹æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ•°æ®

#### æ¶ˆæ¯ä¼ è¾“ä¿éšœ
ä¸ºäº†ç¡®ä¿æ¶ˆæ¯çš„å¯é ä¼ è¾“ï¼Œç³»ç»Ÿå®ç°äº†å®Œæ•´çš„æ¶ˆæ¯ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š

1. **æ¶ˆæ¯å…¥é˜Ÿ**: é€šè¿‡ Redis Stream å°†æ¶ˆæ¯æ”¾å…¥é˜Ÿåˆ—
2. **å¼‚æ­¥å¤„ç†**: ç›‘å¬å™¨å¼‚æ­¥æ¶ˆè´¹é˜Ÿåˆ—æ¶ˆæ¯å¹¶æŒä¹…åŒ–åˆ°æ•°æ®åº“
3. **å¼‚å¸¸å¤„ç†**: å¼‚å¸¸æ¶ˆæ¯è‡ªåŠ¨è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ç­‰å¾…äººå·¥å¤„ç†
4. **çŠ¶æ€åŒæ­¥**: å®æ—¶æ›´æ–°æ¶ˆæ¯çŠ¶æ€å’Œç”¨æˆ·ä¼šè¯ä¿¡æ¯

#### WebSocket é€šä¿¡å±‚
åŸºäº Netty æ„å»ºçš„é«˜æ€§èƒ½ WebSocket æœåŠ¡å™¨ï¼š

- [`NettyServer`]: WebSocket æœåŠ¡å™¨å¯åŠ¨é…ç½®
- [`WebSocketServerHandler`]: WebSocket è¿æ¥å¤„ç†å™¨
- [`AuthHandler`]: è¿æ¥è®¤è¯å¤„ç†å™¨

### ğŸ“¦ æ•°æ®æ¨¡å‹è®¾è®¡

ç³»ç»Ÿé‡‡ç”¨æ¸…æ™°çš„æ•°æ®æ¨¡å‹æ¥ç®¡ç†èŠå¤©ç›¸å…³ä¿¡æ¯ï¼š

- [`Message`]: æ¶ˆæ¯å®ä½“ï¼Œå­˜å‚¨æ‰€æœ‰èŠå¤©å†…å®¹
- [`Room`]: æˆ¿é—´å®ä½“ï¼Œè¡¨ç¤ºèŠå¤©ä¼šè¯
- [`RoomFriend`]: ç§èŠæˆ¿é—´å…³è”
- [`RoomGroup`]: ç¾¤èŠæˆ¿é—´è¯¦æƒ…
- [`UserRoomRelate`]: ç”¨æˆ·ä¸æˆ¿é—´çš„å…³ç³»

### ğŸ”„ æ¶ˆæ¯æµè½¬æµç¨‹

```mermaid
sequenceDiagram
    participant C as å®¢æˆ·ç«¯
    participant W as WebSocketæœåŠ¡
    participant R as Redis Stream
    participant L as æ¶ˆæ¯ç›‘å¬å™¨
    participant DB as æ•°æ®åº“
    
    C->>W: å‘é€æ¶ˆæ¯
    W->>R: æ¶ˆæ¯å…¥é˜Ÿ
    R->>L: å¼‚æ­¥æ¶ˆè´¹
    L->>DB: æŒä¹…åŒ–å­˜å‚¨
    DB-->>L: è¿”å›ç»“æœ
    L->>W: æ¨é€ç¡®è®¤
    W->>C: ACKç¡®è®¤
    L->>W: å¹¿æ’­æ¶ˆæ¯
    W->>C: æ¨é€æ¶ˆæ¯
```


## ğŸ› ï¸ éƒ¨ç½²è¦æ±‚

- Java 17+
- MySQL 8.0+
- Redis 6.0+
- Maven 3.6+
- Nacos Server 2.x

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. å…‹éš†é¡¹ç›®ä»£ç 
2. é…ç½®æ•°æ®åº“å’Œ Redis è¿æ¥ä¿¡æ¯
3. å¯åŠ¨ Nacos æœåŠ¡æ³¨å†Œä¸­å¿ƒ
4. è¿è¡Œåº”ç”¨å¯åŠ¨ç±»
5. WebSocket æœåŠ¡é»˜è®¤ç›‘å¬ 9000 ç«¯å£

## ğŸ“„ è®¸å¯è¯

Apache License Version 2.0

---

**devSphere-chat** - æ„å»ºä¸‹ä¸€ä»£ä¼ä¸šçº§å®æ—¶é€šä¿¡è§£å†³æ–¹æ¡ˆ